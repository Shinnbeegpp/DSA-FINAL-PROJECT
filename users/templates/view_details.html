<!DOCTYPE html>
<html lang="en">
{% load static %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobShark - Commission Overview</title>
    <!-- Load Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font family -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        :root {
            /* Custom Colors based on the image (image_92dfdd.jpg) */
            --primary-purple: #6A3BB8; 
            --secondary-purple: #A586F8; /* Lighter purple/lavender for backgrounds/accents */
            --dark-blue-text: #1F2937; /* Dark text/headers */
            --light-bg-gray: #F9FAFB;
            --white: #FFFFFF;
            --text-gray: #4B5563;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-bg-gray);
            color: var(--dark-blue-text);
        }

        /* Utility classes to match the design */
        .btn-primary {
            background-color: var(--primary-purple);
            color: var(--white);
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: #552EA8; /* Slightly darker on hover */
        }
        
        .card {
            background-color: var(--white);
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
        }

        /* Custom Modal Styles */
        .modal {
            background-color: rgba(0, 0, 0, 0.5);
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--white);
            margin: 10vh auto; /* 10% from the top */
            border-radius: 1rem;
            position: relative;
            padding: 2rem;
            max-width: 90%;
        }

        /* Specific style for the close button, matching the images */
        .modal-close-btn {
            background-color: var(--light-bg-gray);
            color: var(--dark-blue-text);
            transition: background-color 0.2s, color 0.2s;
        }
        .modal-close-btn:hover {
            background-color: #E5E7EB;
        }

        /* Table/Data List styling */
        .data-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #E5E7EB;
        }
        .data-list-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Navbar/Header - Fixed, Two-Tier Structure -->
    <header class="fixed top-0 left-0 right-0 z-50 shadow-lg">

        <!-- 1. Top Bar (Purple) - Desktop Only -->
        <nav class="bg-primary-purple hidden lg:block">
            <div style="background-color: #6a3bb8;">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-center space-x-6 text-white text-sm font-medium py-2">
                        <a href="{% url 'find_job_candidate'%}" class="hover:text-secondary-purple transition duration-150">Find Job</a>
                        <a href="{%  url 'myprofile_commissionee'%}" class="hover:text-secondary-purple transition duration-150">Dashboard</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- 2. Bottom Bar (White) - Desktop/Tablet View -->
        <nav class="bg-white shadow-sm hidden lg:block">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
                <!-- Logo -->
                <p class="flex items-center space-x-2" href="#">
                    <!-- Placeholder for Logo/Site Name -->
                    <img src={% static "images/logo_name.png" %} alt="JobShark Logo" style="width: 150px;" 
                        onerror="this.src='https://placehold.co/150x40/6c63ff/ffffff?text=JobShark&font=inter'; this.onerror=null;">
                </p>

                <!-- User Profile -->
                <div class="flex items-center space-x-3">
                    <span class="text-gray-700 font-medium">
                        {{ user.first_name|default:user.username }} {{ user.last_name }}</span>
                    {% if user.userprofile.profile_picture %}
                        <a href = "{% url 'myprofile_commissionee' %}"><img src="{{ user.userprofile.profile_picture.url }}" 
                        alt="User Avatar" style="width: 40px; height: 40px; object-fit: cover; 
                        border-radius: 8px;"></a>
                    {% else %}
                        <a href = "{% url 'myprofile_commissionee' %}"><img src="{% static 'images/default_pfp.jpg' %}" alt="User Avatar" 
                        style="width: 40px; height: 40px; object-fit: cover; 
                        border-radius: 8px;"></a>
                    {% endif %}
                </div>
            </div>
        </nav>

        <!-- 3. Mobile Navigation -->
        <nav class="bg-white shadow-sm lg:hidden">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3 flex justify-between items-center">
                <!-- Logo -->
                <a class="flex items-center space-x-2" href="#">
                    <svg class="w-8 h-8 text-primary-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    <span class="text-xl font-bold text-dark-blue-text">JobShark</span>
                </a>
                
                <!-- Simple Mobile Nav Placeholder -->
                <div class="flex items-center space-x-4">
                    <span class="text-gray-700 text-sm font-medium hidden sm:block">Esther Howard</span>
                    <img src="https://placehold.co/40x40/6A3BB8/FFFFFF?text=EH" alt="User Avatar" class="w-8 h-8 rounded-full border-2 border-primary-purple">
                    <!-- Hamburger Icon -->
                    <button class="text-gray-500 hover:text-gray-700 p-2 rounded-md transition" onclick="toggleMobileMenu()">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" id="menu-icon"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Menu Dropdown -->
            <div id="mobileMenu" class="hidden absolute top-full left-0 right-0 bg-white shadow-md border-t border-gray-200 py-2">
                <!-- DJANGO PLACEHOLDER: % url 'find_job_page' % -->
                <a href="#" class="block px-4 py-2 text-dark-blue-text hover:bg-gray-50">Find Job</a>
                <!-- DJANGO PLACEHOLDER: % url 'dashboard_page' % -->
                <a href="#" class="block px-4 py-2 text-dark-blue-text hover:bg-gray-50">Dashboard</a>
            </div>
        </nav>
    </header>

    <!-- Main Content Area - Margin adjusted for fixed header (approx 100-112px height) -->
    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 mt-28 lg:mt-24">
        
        <!-- Commission Overview Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
            <h1 class="text-3xl font-extrabold mx-auto ">
                Commission Overview
            </h1>
            <button id="applyJobBtnTop" class="btn-primary flex items-center mt-4 md:mt-0" onclick="openApplyModal()">
                Apply Now 
                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
            </button>
        </div>

        <!-- Main Grid Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Column: Job Details & Requirements -->
            <div class="lg:col-span-2 space-y-8">
                
                <!-- Project Title & Category -->
                <div class="card p-6 border-l-4 border-primary-purple">
                    <h3 class="text-3xl font-bold text-dark-blue-text" id="job-title-display">{{ job.title }}</h3>
                    <!-- DJANGO PLACEHOLDER: {{ job.category }} -->
                    <p class="text-lg text-primary-purple font-medium mt-1">
                        <span class="bg-primary-purple/10 text-primary-purple text-sm font-semibold px-3 py-1 rounded-full">
                            {{ job.category }}
                        </span>
                    </p>
                </div>

                <!-- Job Description & Instructions -->
                <div class="card">
                    <h4 class="text-xl font-bold mb-4 border-b pb-2 ">Job Description & Instructions</h4>
                    <!-- DJANGO PLACEHOLDER: {{ job.description|linebreaks }} -->
                    <div id="job-description-content" class="text-base text-text-gray leading-relaxed">
                        <p class="mb-4 font-serif">{{ job.description|linebreaks }}</p>
                    </div>
                </div>

                <!-- Required Deliverables & Specifications -->
                <div class="card">
                    <h4 class="text-xl font-bold mb-4 border-b pb-2">Required Deliverables & Specifications</h4>
                    <!-- DJANGO PLACEHOLDER: {{ job.deliverables|linebreaks }} -->
                    <div id="job-deliverables-content" class="text-base text-text-gray leading-relaxed ">
                        <ul class="list-disc list-inside space-y-2 pl-4 mb-4 font-serif">
                            <p> {{ job.deliverables|linebreaks }}<p>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Right Column: Overview & Commissioner Info -->
            <div class="lg:col-span-1 space-y-6">
                
                <!-- Job Overview Card -->
                <div class="card text-sm">
                    <h4 class="text-xl font-bold mb-4">Job Overview:</h4>

                    <div class="space-y-3">

                        <div class="data-list-item">
                            <span class="text-gray-500">Job Title:</span>
                            <span class="font-medium">{{ job.title }}</span>
                        </div>

                        <div class="data-list-item">
                            <span class="text-gray-500">Category:</span>
                            <span class="font-medium">{{ job.category }}</span>
                        </div>

                        <div class="data-list-item">
                            <span class="text-gray-500">Service Rate:</span>
                            <span class="font-medium">â‚±{{ job.budget }}</span>
                        </div>

                        <div class="data-list-item">
                            <span class="text-gray-500">Posted Date:</span>
                            <span class="font-medium">{{ job.created_at|date:"M d, Y" }}</span>
                        </div>
                        <div class="data-list-item">
                            <span class="text-gray-500">Status:</span>
                            <span class="font-medium text-primary-purple">{{ job.status }}</span>
                        </div>

                    </div>
                </div>

                <!-- Commissioner Information Card (Limited View) -->
                <div class="card">
                    <h4 class="text-xl font-bold mb-4">Commissioner Information:</h4>
                    <div class="space-y-3 text-sm">
                        <div class="data-list-item">
                            <span class="text-gray-500">Name:</span>
                            <!-- DJANGO PLACEHOLDER: {{ commissioner.name }} -->
                            <span class="font-medium">{{ job.commissioner.first_name }} {{ job.commissioner.last_name }}</span>
                        </div>
                        <div class="data-list-item">
                            <span class="text-gray-500">Campus / Institution:</span>
                            <!-- DJANGO PLACEHOLDER: {{ commissioner.institution }} -->
                            <span class="font-medium">{{ job.commissioner.userprofile.campus_institution|default:"Not specified" }}</span>
                        </div>
                        <div class="data-list-item">
                            <span class="text-gray-500">Education Level:</span>
                            <!-- DJANGO PLACEHOLDER: {{ commissioner.education_level }} -->
                            <span class="font-medium">{{ job.commissioner.userprofile.education|default:"Not specified" }}</span>
                        </div>
                        <div class="data-list-item">
                            <span class="text-gray-500">Past Commissions:</span>
                            <!-- DJANGO PLACEHOLDER: {{ commissioner.completed_commissions }} -->
                            <span class="font-medium text-primary-purple">{{ job.commissioner.posted_jobs.count }}</span>
                        </div>
                    </div>

                    <button class="btn-primary w-full mt-6 flex items-center justify-center" onclick="openCommissionerModal()">
                        More Info 
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                    </button>
                </div>

            </div>

        </div>
    </main>

    <!-- 1. Commissioner Information Modal (More Info) -->
    <div id="commissionerModal" class="modal">
        <div class="modal-content lg:max-w-4xl max-w-lg">
            <button class="absolute top-4 right-4 w-10 h-10 rounded-full flex items-center justify-center modal-close-btn" onclick="closeCommissionerModal()">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            
            <!-- Content structure based on image_92eb9f.png -->
            <div class="flex flex-col md:flex-row space-y-6 md:space-y-0 md:space-x-8">
                
                <!-- Left: Profile & Bio -->
                <div class="w-full md:w-2/3">
                    <div class="flex items-center space-x-4 mb-6">
                        <!-- Placeholder for Profile Picture -->
                        {% if job.commissioner.userprofile.profile_picture %}
                        <img src="{{ job.commissioner.userprofile.profile_picture.url }}" alt="Profile Picture" class="w-20 h-20 rounded-full border-4 border-secondary-purple">
                        {% else %}
                            <img src="{% static 'images/default_pfp.jpg' %}" alt="Profile Picture" class="w-20 h-20 rounded-full border-4 border-secondary-purple">
                        {% endif %}
                        <div>
                            <h3 class="text-2xl font-bold">
                                {{ job.commissioner.first_name }} {{ job.commissioner.last_name }}
                            </h3>
                            <!-- <p class="text-gray-500">{{ job.commissioner.userprofile.student_classification }}</p> -->
                        </div>
                        <div class="ml-auto flex space-x-2">
                            <!-- Action Buttons Placeholder -->
                            
                        <!--<button class="btn-primary flex items-center px-4 py-2 text-sm">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                                Send Message
                            </button>-->
                        </div>
                    </div>

                    <!-- Biography/Details -->
                    <h4 class="text-xl font-bold mb-3 border-b pb-2">BIOGRAPHY</h4>
                    <!-- DJANGO PLACEHOLDER: {{ commissioner.biography|linebreaks }} -->
                    <div class="text-text-gray mb-6">
                        {{ job.commissioner.userprofile.biography|linebreaks|default:"No biography provided." }}
                    </div>
                
                    
                </div>

                <!-- Right: Contact Information -->
                <div class="w-full md:w-1/3 p-4 rounded-lg bg-light-bg-gray">
                    <h4 class="text-lg font-bold mb-4">Contact Information</h4>
                        <div class="space-y-4">
                            <div class="border-b pb-2">
                                <p class="text-xs text-gray-500">EMAIL ADDRESS</p>
                                <div class="flex items-center mt-1">
                                    <span class="text-sm text-dark-blue-text truncate">
                                        {{ job.commissioner.email }}
                                    </span>
                                </div>
                            </div>
                            <div class="border-b pb-2">
                                <p class="text-xs text-gray-500">PHONE</p>
                                <div class="flex items-center mt-1">
                                    <span class="text-sm text-dark-blue-text truncate">
                                        {{ job.commissioner.userprofile.phone_number|default:"Not Provided" }}
                                    </span>
                                </div>
                            </div>
                            <div class="border-b pb-2">
                                <p class="text-xs text-gray-500">SOCIAL LINK</p>
                                <div class="flex items-center mt-1">
                                    <span class="text-sm text-dark-blue-text truncate">
                                        {{ job.commissioner.userprofile.social_link|default:"Not Provided" }}
                                    </span>
                                </div>
                            </div>
                        </div>
                </div>
            </div>

        </div>
    </div>

    <!-- 2. Apply Job Modal -->
    <div id="applyModal" class="modal">
        <div class="modal-content max-w-2xl">
            <button class="absolute top-4 right-4 w-10 h-10 rounded-full flex items-center justify-center modal-close-btn" onclick="closeApplyModal()">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            
            <h3 class="text-2xl font-bold mb-6">Apply for: <span id="modal-job-title" class="text-primary-purple">Research Chapter 1-3 (Placeholder)</span></h3>
            
            <!-- Application Form based on image_92eb79.png -->
            <form id="applicationForm" method="POST" action="{% url 'apply_for_job' job.id %}">
                {% csrf_token %}
                
                <div class="mb-6 relative">
                    <label for="resumeSelect" class="block text-sm font-medium text-gray-700 mb-2">Choose Resume</label>
                    <select id="resumeSelect" name="resume_id" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary-purple focus:border-primary-purple appearance-none bg-white">
                        <option value="" disabled selected>Select...</option>
                        {% for resume in resumes %}
                            <option value="{{ resume.id }}">{{ resume.filename }}</option>
                        {% empty %}
                            <option disabled>No resumes found. Please upload one in Settings.</option>
                        {% endfor %}
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 top-9 mr-2">
                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                    </div>
                </div>

                <div class="mb-6">
                    <label for="coverLetter" class="block text-sm font-medium text-gray-700 mb-2">Cover Letter</label>
                    <div class="border border-gray-300 rounded-lg overflow-hidden">
                        <textarea id="coverLetter" name="cover_letter" rows="8" placeholder="Write down your pitch here..." required class="w-full p-4 focus:ring-0 focus:outline-none resize-y text-sm"></textarea>
                    </div>
                </div>

                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" onclick="closeApplyModal()" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition">
                        Cancel
                    </button>
                    <button type="submit" class="btn-primary flex items-center">
                        Submit Application
                        <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 3. Application Successful Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content max-w-xl text-center p-12">
            <button class="absolute top-4 right-4 w-10 h-10 rounded-full flex items-center justify-center modal-close-btn" onclick="closeSuccessModal()">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            
            <!-- Success Icon -->
            <div class="flex justify-center mb-6">
                <svg class="w-20 h-20 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            </div>

            <h3 class="text-3xl font-extrabold mb-4">Your application has been submitted successfully.</h3>
            <p class="text-lg text-text-gray mb-8">
                The commissioner will review your details and contact you once your application has been approved.
            </p>

            <button class="btn-primary flex items-center justify-center mx-auto" onclick="window.location.reload()">
                View Jobs 
                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
            </button>
        </div>
    </div>


    <script>
        // --- Modal Functionality ---

        const commissionerModal = document.getElementById('commissionerModal');
        const applyModal = document.getElementById('applyModal');
        const successModal = document.getElementById('successModal');
        const mobileMenu = document.getElementById('mobileMenu');
        const menuIcon = document.getElementById('menu-icon');

        // General function to open a modal
        function openModal(modal) {
            modal.style.display = 'block';
            document.body.classList.add('overflow-hidden');
        }

        // General function to close a modal
        function closeModal(modal) {
            modal.style.display = 'none';
            document.body.classList.remove('overflow-hidden');
        }

        // Toggle Mobile Menu
        function toggleMobileMenu() {
            if (mobileMenu.classList.contains('hidden')) {
                mobileMenu.classList.remove('hidden');
                menuIcon.setAttribute('d', 'M6 18L18 6M6 6l12 12'); // X icon
            } else {
                mobileMenu.classList.add('hidden');
                menuIcon.setAttribute('d', 'M4 6h16M4 12h16M4 18h16'); // Hamburger icon
            }
        }

        // Open Commissioner Modal (More Info)
        function openCommissionerModal() {
            openModal(commissionerModal);
        }

        // Close Commissioner Modal
        function closeCommissionerModal() {
            closeModal(commissionerModal);
        }

        // Open Apply Modal
        function openApplyModal() {
            // Set the job title in the modal header
            const jobTitle = document.getElementById('job-title-display').textContent;
            document.getElementById('modal-job-title').textContent = jobTitle;
            openModal(applyModal);
        }

        // Close Apply Modal
        function closeApplyModal() {
            closeModal(applyModal);
        }

        // Open Success Modal
        function openSuccessModal() {
            openModal(successModal);
        }

        // Close Success Modal
        function closeSuccessModal() {
            closeModal(successModal);
        }

        
    

        // Close modals when clicking outside of them
        window.onclick = function(event) {
            if (event.target === commissionerModal) {
                closeCommissionerModal();
            } else if (event.target === applyModal) {
                closeApplyModal();
            } else if (event.target === successModal) {
                closeSuccessModal();
            }
        }
    </script>
</body>
</html>